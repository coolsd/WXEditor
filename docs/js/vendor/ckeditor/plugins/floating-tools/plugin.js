!function(){var o=function(){this.dom=null,this.toolbars=[],this.is_visible=!1,this.hide_on_blur=!0,this.toolbarsize=!1,this.editoroffset=!1,this.mousepos={x:0,y:0}};CKEDITOR.plugins.add("floating-tools",{requires:"toolbar",init:function(t){t.on("uiSpace",function(e){function s(o){var e=o.render(t,a);v=g.items.push(e)-1,v>0&&(e.previous=g.items[v-1],e.previous.next=e),e.toolbar=g}e.removeListener(),t.floatingtools=new o;for(var i,n,l=CKEDITOR.tools.getNextId(),a=["<style>",".pos-relative {position:relative}",".cke_floatingtools{","position:absolute;","left:0;","top:-500px;","padding: 5px 0 0 6px;","border:1px solid #b1b1b1;","border-radius:3px;","box-shadow: 0 1px 10px rgba(0,0,0,0.3);","transition:opacity .1s;-o-transition:opacity .1s;-moz-transition:opacity .1s;-webkit-transition:opacity .1s;","}","</style>",'<span id="',l,'" class="cke_voice_label">',t.lang.toolbar.toolbars,"</span>",'<span id="'+t.ui.spaceId("floatingtools")+'" class="cke_floatingtools cke_top" role="group" aria-labelledby="',l,'" onmousedown="return false;">'],r=t.floatingtools.toolbars,f=getFloatingToolbarConfig(t),u=0;u<f.length;u++){var p,c,d,g=0,b=f[u];if(b)if(i&&(a.push("</span>"),i=0,n=0),"/"!==b){d=b.items||b;for(var _=0;_<d.length;_++){var h,m=d[_];if(m){if(m.type==CKEDITOR.UI_SEPARATOR){n=i&&m;continue}if(h=m.canGroup!==!1,!g){p=CKEDITOR.tools.getNextId(),g={id:p,items:[]},c=b.name&&(t.lang.toolbar.toolbarGroups[b.name]||b.name),a.push('<span id="',p,'" class="cke_toolbar"',c?' aria-labelledby="'+p+'_label"':"",' role="toolbar">'),c&&a.push('<span id="',p,'_label" class="cke_voice_label">',c,"</span>"),a.push('<span class="cke_toolbar_start"></span>');var v=r.push(g)-1;v>0&&(g.previous=r[v-1],g.previous.next=g)}h?i||(a.push('<span class="cke_toolgroup" role="presentation">'),i=1):i&&(a.push("</span>"),i=0),n&&(s(n),n=0),s(m)}}i&&(a.push("</span>"),i=0,n=0),g&&a.push('<span class="cke_toolbar_end"></span></span>')}else a.push('<span class="cke_toolbar_break"></span>')}a.push("</span>"),e.data.html+=a.join("")}),t.on("contentDom",function(o){unfocus_toolbar(),t.document.on("mouseup",function(o){return data=o.data.$,0!==data.button||data.ctrlKey||data.altKey||data.shiftKey?!0:void setTimeout(function(){is_text_selected()?(set_mousepos(o.data.$),t.execCommand("showFloatingTools")):t.execCommand("hideFloatingTools")},100)}),t.document.on("keyup",function(o){t.execCommand("hideFloatingTools")}),t.on("blur",function(o){t.floatingtools.hide_on_blur&&hide_toolbar()}),toolbar=get_element(),toolbar.on("mouseover",function(o){focus_toolbar()}),toolbar.on("mouseout",function(o){unfocus_toolbar()}),t.container.addClass("pos-relative")}),t.addCommand("showFloatingTools",{exec:function(o){is_text_selected()&&(toolbar=get_element(),unfocus_toolbar(),toolbar.show(),size=get_toolbar_size(),offset=get_editor_offset(),pos=get_mousepos(),toolpos=calculate_position(pos,size,offset),toolbar.setStyles({left:toolpos.x+"px",top:toolpos.y+"px"}),o.floatingtools.is_visible=!0)}}),t.addCommand("hideFloatingTools",{exec:function(o){hide_toolbar()}}),hide_toolbar=function(){0!=t.floatingtools.is_visible&&(toolbar=get_element(),toolbar.hide(),t.floatingtools.is_visible=!1)},set_mousepos=function(o){t.floatingtools.mousepos={left:o.clientX,top:o.clientY}},get_mousepos=function(){return t.floatingtools.mousepos},get_element=function(){if(!t.floatingtools.dom){var o=t.ui.spaceId("floatingtools");t.floatingtools.dom=CKEDITOR.document.getById(o)}return t.floatingtools.dom},get_editor_offset=function(){if(!t.floatingtools.editoroffset){var o=t.ui.spaceId("contents"),e=CKEDITOR.document.getById(o);t.floatingtools.editoroffset={left:e.$.offsetLeft,top:e.$.offsetTop,width:e.$.offsetWidth,height:e.$.offsetHeight}}return t.floatingtools.editoroffset},calculate_position=function(o,t,e){return toolpos={x:o.left+e.left-t.width/2,y:o.top+e.top-(t.height+20)},toolpos.x<e.left+2&&(toolpos.x=e.left+2),o.left+t.width/2>=e.left+e.width-2&&(toolpos.x=e.left+e.width-t.width-2),toolpos.y<e.top&&(toolpos.y=e.top),e.top+o.top>toolpos.y&&e.top+o.top<toolpos.y+t.height&&(toolpos.y=e.top+o.top+24),toolpos},get_toolbar_size=function(){if(!t.floatingtools.toolbarsize){var o=get_element();t.floatingtools.toolbarsize={width:o.$.offsetWidth,height:o.$.offsetHeight}}return t.floatingtools.toolbarsize},is_text_selected=function(){var o=t.getSelection().getSelectedText();return""!=o},focus_toolbar=function(){obj=get_element(),obj.setOpacity(1)},unfocus_toolbar=function(){obj=get_element(),obj.setOpacity(.25)},getFloatingToolbarConfig=function(o){function t(){var t=getPrivateFloatingToolbarGroups(o);return s(t)}function e(t,e){if(e.length){t.items?t.items.push(o.ui.create("-")):t.items=[];for(var s,n;s=e.shift();)if(n="string"==typeof s?s:s.name,!i||-1==CKEDITOR.tools.indexOf(i,n)){if(s=o.ui.create(n),!s)continue;if(!o.addFeature(s))continue;t.items.push(s)}}}function s(o){var t,s,i,n=[];for(t=0;t<o.length;++t)s=o[t],i={},"/"==s?n.push(s):CKEDITOR.tools.isArray(s)?(e(i,CKEDITOR.tools.clone(s)),n.push(i)):s.items&&(e(i,CKEDITOR.tools.clone(s.items)),i.name=s.name,n.push(i));return n}var i=o.config.removeButtons;i=i&&i.split(",");var n=o.config.floatingtools;return"string"==typeof n&&(n=o.config["floatingtools_"+n]),o.toolbar=n?s(n):t()},getPrivateFloatingToolbarGroups=function(o){return o._.floatingToolsGroups||(o._.floatingToolsGroups=[{name:"styles",items:["FontSize"]},{name:"paragraph",items:["JustifyCenter"]}])}}})}();