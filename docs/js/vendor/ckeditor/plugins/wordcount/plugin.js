/**
 * @license Copyright (c) CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.html or http://ckeditor.com/license
 */

CKEDITOR.plugins.add("wordcount",{lang:"ca,de,el,en,es,fr,hr,it,jp,nl,no,pl,pt-br,ru,sv,tr,zh-cn",version:1.13,requires:"htmlwriter,notification,undo",init:function(n){function t(n){return"cke_wordcount_"+n.name}function a(n){return document.getElementById(t(n))}function e(n){var t=document.createElement("div");return t.innerHTML=n,""==t.textContent&&"undefined"==typeof t.innerText?"":t.textContent||t.innerText}function o(t,a){if(v.countHTML)return a.getSnapshot().length;var o;if(n.config.fullPage){var r=t.search(new RegExp("<body>","i"));if(-1!=r){var u=t.search(new RegExp("</body>","i"));t=t.substring(r+6,u)}}return o=t,v.countSpacesAsChars||(o=t.replace(/\s/g,"").replace(/&nbsp;/g,"")),o=o.replace(/(\r\n|\n|\r)/gm,"").replace(/&nbsp;/gi," "),o=e(o).replace(/^([\t\r\n]*)$/,""),o.length}function r(n){return n.replace(/&nbsp;/g," ").replace(/(<([^>]+)>)/gi,"").replace(/^\s*$[\n\r]{1,}/gm,"++").split("++").length}function u(n){var t=n.replace(/(\r\n|\n|\r)/gm," ").replace(/^\s+|\s+$/g,"").replace("&nbsp;"," ");t=e(t);for(var a=t.split(/\s+/),o=a.length-1;o>=0;o--)a[o].match(/^([\s\t\r\n]*)$/)&&a.splice(o,1);return a.length}function c(t,e){g=!0,p=!1,v.hardLimit&&(t.loadSnapshot(m),t.config.Locked=1),e||(a(t).className="cke_path_item cke_wordcountLimitReached",t.fire("limitReached",{},n))}function h(t){p=!0,g=!1,t.config.Locked=0,m=n.getSnapshot(),a(t).className="cke_path_item"}function s(n){var t,e=0,s=0,i=0;(t=n.getData())&&(v.showCharCount&&(i=o(t,n)),v.showParagraphs&&(e=r(t)),v.showWordCount&&(s=u(t)));var d=L.replace("%wordCount%",s).replace("%charCount%",i).replace("%paragraphs%",e);if(n.plugins.wordcount.wordCount=s,n.plugins.wordcount.charCount=i,CKEDITOR.env.gecko?a(n).innerHTML=d:a(n).innerText=d,i==l&&s==C)return!0;var w=s-C,x=i-l;return C=s,l=i,-1==C&&(C=s),-1==l&&(l=i),v.maxWordCount>-1&&s>v.maxWordCount&&w>0||v.maxCharCount>-1&&i>v.maxCharCount&&x>0?c(n,g):!p&&(-1==v.maxWordCount||s<v.maxWordCount)&&(-1==v.maxCharCount||i<v.maxCharCount)?h(n):m=n.getSnapshot(),v.charCountGreaterThanMaxLengthEvent&&v.charCountLessThanMaxLengthEvent&&(i>v.maxCharCount&&v.maxCharCount>-1?v.charCountGreaterThanMaxLengthEvent(i,v.maxCharCount):v.charCountLessThanMaxLengthEvent(i,v.maxCharCount)),v.wordCountGreaterThanMaxLengthEvent&&v.wordCountLessThanMaxLengthEvent&&(s>v.maxWordCount&&v.maxWordCount>-1?v.wordCountGreaterThanMaxLengthEvent(s,v.maxWordCount):v.wordCountLessThanMaxLengthEvent(s,v.maxWordCount)),!0}var i,d="",C=-1,l=-1,g=!1,p=!1,m=n.getSnapshot(),w=function(n,t,a){if("undefined"!=typeof document.dispatchEvent){n="ckeditor.wordcount."+n;var e,o={bubbles:!1,cancelable:!0,detail:{currentLength:t,maxLength:a}};try{e=new CustomEvent(n,o)}catch(r){e=document.createEvent("CustomEvent"),e.initCustomEvent(n,o.bubbles,o.cancelable,o.detail)}document.dispatchEvent(e)}},x={showParagraphs:!0,showWordCount:!0,showCharCount:!1,countSpacesAsChars:!1,countHTML:!1,hardLimit:!0,maxWordCount:-1,maxCharCount:-1,wordCountGreaterThanMaxLengthEvent:function(n,t){w("wordCountGreaterThanMaxLengthEvent",n,t)},charCountGreaterThanMaxLengthEvent:function(n,t){w("charCountGreaterThanMaxLengthEvent",n,t)},wordCountLessThanMaxLengthEvent:function(n,t){w("wordCountLessThanMaxLengthEvent",n,t)},charCountLessThanMaxLengthEvent:function(n,t){w("charCountLessThanMaxLengthEvent",n,t)}},v=CKEDITOR.tools.extend(x,n.config.wordcount||{},!0);if(v.showParagraphs&&(d+=n.lang.wordcount.Paragraphs+" %paragraphs%"),v.showParagraphs&&(v.showWordCount||v.showCharCount)&&(d+=", "),v.showWordCount&&(d+=n.lang.wordcount.WordCount+" %wordCount%",v.maxWordCount>-1&&(d+="/"+v.maxWordCount)),v.showCharCount&&v.showWordCount&&(d+=", "),v.showCharCount){var f=n.lang.wordcount[v.countHTML?"CharCountWithHTML":"CharCount"];d+=f+" %charCount%",v.maxCharCount>-1&&(d+="/"+v.maxCharCount)}var L=d;(void 0===v.loadCss||v.loadCss)&&CKEDITOR.document.appendStyleSheet(this.path+"css/wordcount.css"),n.on("key",function(t){"source"===n.mode&&s(t.editor)},n,null,100),n.on("change",function(n){s(n.editor)},n,null,100),n.on("uiSpace",function(a){n.elementMode===CKEDITOR.ELEMENT_MODE_INLINE?"top"==a.data.space&&(a.data.html+='<div class="cke_wordcount" style="" title="'+n.lang.wordcount.title+'"><span id="'+t(a.editor)+'" class="cke_path_item">&nbsp;</span></div>'):"bottom"==a.data.space&&(a.data.html+='<div class="cke_wordcount" style="" title="'+n.lang.wordcount.title+'"><span id="'+t(a.editor)+'" class="cke_path_item">&nbsp;</span></div>')},n,null,100),n.on("dataReady",function(n){s(n.editor)},n,null,100),n.on("paste",function(n){if(v.maxWordCount>0||v.maxCharCount>0){var t=0,a=0,e=n.editor.getData()+n.data.dataValue;v.showCharCount&&(a=o(e,n.editor)),v.showWordCount&&(t=u(e));var r=new CKEDITOR.plugins.notification(n.editor,{message:n.editor.lang.wordcount.pasteWarning,type:"warning"});a>v.maxCharCount&&(r.show(),n.cancel()),t>v.maxWordCount&&(r.show(),n.cancel())}},n,null,100),n.on("afterPaste",function(n){s(n.editor)},n,null,100),n.on("blur",function(){i&&window.clearInterval(i)},n,null,300)}});